<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Genesis Ops Board</title>
  <style>
    body { font-family: Inter, Segoe UI, Arial, sans-serif; margin: 0; background: radial-gradient(circle at 20% 20%, #0f1f1b 0%, #071017 45%, #05080f 100%); color: #d1fae5; }
    h1 { margin: 0 0 6px; letter-spacing: 0.5px; }
    .muted { color: #86efac; margin-bottom: 18px; opacity: 0.8; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 12px; }
    .card { background: linear-gradient(180deg, rgba(6,20,24,0.9), rgba(6,15,20,0.95)); border: 1px solid #14532d; border-radius: 12px; padding: 14px; box-shadow: inset 0 0 0 1px rgba(16,185,129,0.08); }
    .card h2 { margin: 0 0 10px; font-size: 16px; }
    ul { margin: 0; padding-left: 18px; }
    li { margin: 6px 0; }
    .badge { display: inline-block; padding: 3px 8px; border-radius: 999px; background: #0f172a; color: #a7f3d0; font-size: 12px; margin-right: 6px; border: 1px solid #14532d; }
    .ok { background: #14532d; color: #dcfce7; }
    .idle { background: #1f2937; color: #bbf7d0; }
    .stale { background: #7f1d1d; color: #fee2e2; }
    .pulse { animation: pulse 1.8s ease-in-out infinite; }
    .typingDots::after { content: '...'; display: inline-block; width: 16px; text-align: left; animation: dots 1.2s steps(4, end) infinite; }
    .profileBox { background: linear-gradient(135deg, #111827 0%, #1f2937 100%); border: 1px solid #334155; }
    .avatar { width: 92px; height: 92px; border-radius: 999px; display: inline-flex; align-items: center; justify-content: center; background: #0f172a; border: 1px solid #334155; margin-right: 12px; overflow: hidden; }
    .avatar svg { width: 74px; height: 74px; }
    .baymax-head { fill: #f8fafc; }
    .baymax-eye { fill: #0f172a; }
    .baymax-line { stroke: #0f172a; stroke-width: 2; }
    .avatar.active svg { animation: baymaxBreath 2.4s ease-in-out infinite; }
    .avatar.idle svg { animation: baymaxIdle 3s ease-in-out infinite; opacity: 0.95; }
    .avatar.stale svg { animation: baymaxAlert 1s ease-in-out infinite; }
    .profileHeader { display: flex; align-items: center; margin-bottom: 10px; }
    .profileSub { color: #94a3b8; font-size: 13px; }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.35);} 50% { box-shadow: 0 0 0 10px rgba(34,197,94,0);} }
    @keyframes dots { 0% { content: '.';} 33% { content: '..';} 66% { content: '...';} 100% { content: ''; } }
    @keyframes baymaxBreath { 0%,100% { transform: scale(1);} 50% { transform: scale(1.09);} }
    @keyframes baymaxIdle { 0%,100% { transform: translateY(0);} 50% { transform: translateY(3px);} }
    @keyframes baymaxAlert { 0%,100% { transform: scale(1);} 50% { transform: scale(1.14);} }
    .p0 { background: #7f1d1d; color: #fee2e2; }
    .p1 { background: #78350f; color: #fef3c7; }
    .p2 { background: #1e3a8a; color: #dbeafe; }
    .chip { display: inline-block; padding: 2px 7px; border-radius: 999px; background: #1f2937; font-size: 12px; margin-right: 6px; }
    .risk-high { color: #fca5a5; }
    .risk-medium { color: #fde68a; }
    .risk-low { color: #86efac; }
    code { background: #111827; border: 1px solid #334155; border-radius: 6px; padding: 2px 6px; }
    .row { margin-top: 16px; }
    .tight li { margin: 8px 0; }
    .missionControlBar { display: flex; gap: 8px; align-items: center; margin: 0 0 14px; }
    .led { width: 10px; height: 10px; border-radius: 999px; display: inline-block; }
    .led.green { background: #22c55e; box-shadow: 0 0 8px #22c55e; }
    .led.amber { background: #f59e0b; box-shadow: 0 0 8px #f59e0b; }
    .led.red { background: #ef4444; box-shadow: 0 0 8px #ef4444; }
    .mcTag { font-size: 11px; color: #86efac; border: 1px solid #14532d; padding: 2px 7px; border-radius: 999px; }
    .layout { display: grid; grid-template-columns: 220px 1fr; min-height: 100vh; }
    .sidebar { border-right: 1px solid #14532d; background: rgba(2,10,14,0.9); padding: 14px 12px; position: sticky; top: 0; height: 100vh; }
    .sidebar h3 { margin: 10px 6px 10px; font-size: 12px; color: #86efac; text-transform: uppercase; letter-spacing: 1px; }
    .sidebarProfile { border: 1px solid #14532d; border-radius: 12px; padding: 10px; margin-bottom: 12px; background: rgba(6,20,24,0.9); }
    .sidebarProfile .avatar { width: 64px; height: 64px; margin-right: 8px; }
    .sidebarProfile .avatar svg { width: 52px; height: 52px; }
    .navLink { display: block; width: 100%; color: #dcfce7; text-decoration: none; border: 1px solid #14532d; border-radius: 10px; padding: 11px 12px; margin: 6px 0; font-size: 14px; background: linear-gradient(180deg, rgba(20,83,45,0.35), rgba(6,20,24,0.9)); box-sizing: border-box; }
    .navLink:hover { border-color: #22c55e; background: linear-gradient(180deg, rgba(22,101,52,0.5), rgba(6,20,24,0.95)); transform: translateY(-1px); }
    .main { padding: 24px; }
    html { scroll-behavior: smooth; }
    #dashboard, #agents, #activity, #tasks, #skills, #usage, #models { scroll-margin-top: 20px; }

  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebarProfile">
        <div class="profileHeader" style="margin-bottom:6px;">
          <div id="profileAvatarSide" class="avatar idle" title="Genesis status">
            <svg viewBox="0 0 64 64" role="img" aria-label="Baymax-like avatar">
              <ellipse class="baymax-head" cx="32" cy="32" rx="23" ry="17"></ellipse>
              <circle class="baymax-eye" cx="24" cy="32" r="2.8"></circle>
              <circle class="baymax-eye" cx="40" cy="32" r="2.8"></circle>
              <line class="baymax-line" x1="26.8" y1="32" x2="37.2" y2="32"></line>
            </svg>
          </div>
          <div>
            <div><strong>Genesis</strong></div>
            <div class="profileSub">Mission Operator</div>
          </div>
        </div>
        <span id="profileStatusSide" class="badge idle">Booting</span>
      </div>

      <h3>Mission Nav</h3>
      <a class="navLink" href="#dashboard">Dashboard</a>
      <a class="navLink" href="#agents">Agents</a>
      <a class="navLink" href="#activity">Activity</a>
      <a class="navLink" href="#tasks">Tasks</a>
      <a class="navLink" href="#skills">Skills</a>
      <a class="navLink" href="#usage">Usage</a>
      <a class="navLink" href="#models">Models</a>
    </aside>

    <main class="main" id="dashboard">
      <h1>Genesis Mission Control (v3)</h1>
      <div class="missionControlBar">
        <span class="led green"></span><span class="mcTag">SYSTEMS NOMINAL</span>
        <span class="led amber"></span><span class="mcTag">EXECUTION</span>
        <span class="led red"></span><span class="mcTag">RISK WATCH</span>
      </div>
      <div class="muted">Mission-control view. Data source: <code>memory/todo.json</code>.</div>

      <div class="card" style="margin-bottom:12px;" id="models">
        <h2>Models & Mission</h2>
        <ul>
          <li><strong>Primary:</strong> <code>gpt-5.3-codex</code></li>
          <li><strong>Heartbeat:</strong> <code>ollama/qwen2.5:7b</code> (30m)</li>
          <li><strong>Mission:</strong> <span id="missionText">-</span></li>
        </ul>
      </div>

      <div class="grid">
    <div class="card profileBox" id="agents">
      <h2>Agents</h2>
      <div class="profileHeader">
        <div id="profileAvatar" class="avatar idle" title="Baymax-inspired status avatar">
          <svg viewBox="0 0 64 64" role="img" aria-label="Baymax-like avatar">
            <ellipse class="baymax-head" cx="32" cy="32" rx="23" ry="17"></ellipse>
            <circle class="baymax-eye" cx="24" cy="32" r="2.8"></circle>
            <circle class="baymax-eye" cx="40" cy="32" r="2.8"></circle>
            <line class="baymax-line" x1="26.8" y1="32" x2="37.2" y2="32"></line>
          </svg>
        </div>
        <div>
          <div><strong id="profileName">Genesis</strong> <span class="profileSub">AI Operator</span></div>
          <div class="profileSub" id="profileMood">Sharp, funny, and in shipping mode.</div>
        </div>
      </div>
      <p>
        <span id="profileStatus" class="badge idle">Booting</span>
        <span id="profileAnim" class="badge">Waiting</span>
      </p>
      <ul>
        <li><strong>Mission Fit:</strong> <span id="missionFit">-</span></li>
        <li><strong>Current Focus:</strong> <span id="focusTask">-</span></li>
        <li><strong>Execution Mode:</strong> <span id="execMode">Lean + Fast</span></li>
      </ul>
    </div>

    <div class="card" id="usage">
      <h2>Live Status</h2>
      <p>
        <span id="stateBadge" class="badge idle">Loading...</span>
        <span id="ageBadge" class="badge">Data age: -</span>
        <span id="costBadge" class="badge">Cost: -</span>
      </p>
      <ul>
        <li><strong>Last update:</strong> <span id="lastUpdate">-</span></li>
        <li><strong>Current task:</strong> <span id="currentTask">-</span></li>
        <li><strong>Next task:</strong> <span id="nextTask">-</span></li>
        <li><strong>Heartbeat:</strong> 30m on <code>ollama/qwen2.5:7b</code></li>
      </ul>
    </div>

    <div class="card">
      <h2>KPIs</h2>
      <ul class="tight" id="kpiList"><li>-</li></ul>
    </div>

    <div class="card" id="tasks">
      <h2>Now (Priority Queue)</h2>
      <ul id="nowList"><li>-</li></ul>
    </div>

    <div class="card">
      <h2>Next</h2>
      <ul id="nextList"><li>-</li></ul>
    </div>

    <div class="card">
      <h2>Risks & Blockers</h2>
      <ul id="riskList"><li>None</li></ul>
      <ul id="blockedList" style="margin-top:8px;"><li>None</li></ul>
    </div>

    <div class="card" id="activity">
      <h2>Activity Log</h2>
      <ul id="activityList"><li>-</li></ul>
    </div>

    <div class="card">
      <h2>Last Completed</h2>
      <ul id="doneList"><li>-</li></ul>
    </div>

    <div class="card" id="skills">
      <h2>Skills</h2>
      <ul>
        <li>sales-operator</li>
        <li>product-packager</li>
        <li>growth-analyst</li>
        <li>content-engine</li>
        <li>ops-custodian</li>
      </ul>
    </div>

    <div class="card">
      <h2>Ops Shortcuts</h2>
      <ul>
        <li><code>openclaw status</code></li>
        <li><code>openclaw gateway start</code></li>
        <li><code>openclaw pairing list telegram</code></li>
        <li><code>openclaw channels status</code></li>
      </ul>
    </div>
  </div>

  <div class="row muted">Tip: hard refresh if cache is sticky. Auto-refresh every 60s.</div>
    </main>
  </div>

  <script>
    function byId(id) { return document.getElementById(id); }

    function formatTs(ts) {
      const d = new Date(ts);
      if (Number.isNaN(d.getTime())) return '-';
      return d.toLocaleString();
    }

    function minutesSince(ts) {
      const d = new Date(ts);
      if (Number.isNaN(d.getTime())) return 9999;
      return Math.floor((Date.now() - d.getTime()) / 60000);
    }

    function score(task) {
      if (!task || typeof task !== 'object') return 0;
      return (Number(task.impact) || 0) * (Number(task.speed) || 0) * (Number(task.confidence) || 0);
    }

    function dueChip(due) {
      if (!due) return '';
      const text = String(due).toLowerCase();
      if (text === 'today') return '<span class="chip p0">today</span>';
      if (text === 'this-week') return '<span class="chip p1">this week</span>';
      return '<span class="chip p2">later</span>';
    }

    function priorityClass(p) {
      const v = String(p || '').toLowerCase();
      if (v === 'p0') return 'p0';
      if (v === 'p1') return 'p1';
      return 'p2';
    }

    function renderTaskList(id, tasks) {
      const el = byId(id);
      el.innerHTML = '';
      if (!Array.isArray(tasks) || !tasks.length) {
        el.innerHTML = '<li>None</li>';
        return;
      }

      const normalized = tasks.map(t => typeof t === 'string' ? { title: t, priority: 'P2' } : t)
        .sort((a, b) => score(b) - score(a));

      normalized.forEach(t => {
        const li = document.createElement('li');
        const pr = String(t.priority || 'P2').toUpperCase();
        const cls = priorityClass(pr);
        const s = score(t);
        const owner = t.owner ? ` · ${t.owner}` : '';
        li.innerHTML = `<span class="badge ${cls}">${pr}</span>${dueChip(t.due)} <strong>${t.title || '-'}</strong> <span class="muted">(score ${s}${owner})</span>`;
        el.appendChild(li);
      });
    }

    function renderSimpleList(id, items, fallback = 'None') {
      const el = byId(id);
      el.innerHTML = '';
      const values = Array.isArray(items) && items.length ? items : [fallback];
      values.forEach(v => {
        const li = document.createElement('li');
        li.textContent = typeof v === 'string' ? v : JSON.stringify(v);
        el.appendChild(li);
      });
    }

    function renderRisks(risks) {
      const el = byId('riskList');
      el.innerHTML = '';
      if (!Array.isArray(risks) || !risks.length) {
        el.innerHTML = '<li>Risks: None</li>';
        return;
      }
      risks.forEach(r => {
        const li = document.createElement('li');
        const sev = String(r.severity || 'low').toLowerCase();
        li.innerHTML = `<span class="risk-${sev}"><strong>${(r.title || '-')}</strong> (${sev})</span><br/><span class="muted">Owner: ${r.owner || '-'} · Next: ${r.nextStep || '-'}</span>`;
        el.appendChild(li);
      });
    }

    function renderKpis(kpis) {
      const el = byId('kpiList');
      el.innerHTML = '';
      const data = kpis || {};
      const lines = [
        `Published assets: ${data.publishedAssets ?? 0}`,
        `Starter templates: ${data.starterTemplates ?? 0}`,
        `Leads: ${data.leads ?? 0}`,
        `Revenue (USD): ${data.revenueUsd ?? 0}`,
        `Streak days: ${data.streakDays ?? 0}`
      ];
      lines.forEach(t => {
        const li = document.createElement('li');
        li.textContent = t;
        el.appendChild(li);
      });
    }

    function renderActivity(activity) {
      const el = byId('activityList');
      el.innerHTML = '';
      if (!Array.isArray(activity) || !activity.length) {
        el.innerHTML = '<li>No recent activity</li>';
        return;
      }
      activity.slice().reverse().slice(0, 8).forEach(a => {
        const li = document.createElement('li');
        if (typeof a === 'string') {
          li.textContent = a;
        } else {
          li.innerHTML = `<strong>${formatTs(a.time)}</strong> — ${a.text || '-'}`;
        }
        el.appendChild(li);
      });
    }

    function setStatus(ts) {
      const state = byId('stateBadge');
      const age = byId('ageBadge');
      const pState = byId('profileStatus');
      const pStateSide = byId('profileStatusSide');
      const pAnim = byId('profileAnim');
      const avatar = byId('profileAvatar');
      const avatarSide = byId('profileAvatarSide');
      const mins = minutesSince(ts);
      const online = mins <= 120;
      const stale = mins > 240;

      state.textContent = online ? 'Online' : 'Idle';
      state.className = 'badge ' + (online ? 'ok pulse' : 'idle');

      age.textContent = `Data age: ${mins}m`;
      age.className = 'badge ' + (stale ? 'stale' : '');

      pState.textContent = online ? 'Active' : 'Idle';
      pState.className = 'badge ' + (online ? 'ok pulse' : 'idle');
      pStateSide.textContent = online ? 'Active' : 'Idle';
      pStateSide.className = 'badge ' + (online ? 'ok pulse' : 'idle');

      if (stale) {
        pAnim.textContent = 'Sync Lag';
        pAnim.className = 'badge stale';
        avatar.className = 'avatar stale';
        avatarSide.className = 'avatar stale';
      } else if (online) {
        pAnim.textContent = 'Working';
        pAnim.className = 'badge typingDots';
        avatar.className = 'avatar active';
        avatarSide.className = 'avatar active';
      } else {
        pAnim.textContent = 'Standing by';
        pAnim.className = 'badge';
        avatar.className = 'avatar idle';
        avatarSide.className = 'avatar idle';
      }
    }

    function firstTaskTitle(list) {
      if (!Array.isArray(list) || !list.length) return '-';
      const v = list[0];
      return typeof v === 'string' ? v : (v.title || '-');
    }

    async function loadBoard() {
      try {
        const res = await fetch('./memory/todo.json?ts=' + Date.now());
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();

        byId('missionText').textContent = data.mission || 'No mission set.';
        byId('focusTask').textContent = firstTaskTitle(data.now);
        byId('missionFit').textContent = data.mission ? 'Aligned' : 'Undefined';
        byId('profileMood').textContent = (data.now && data.now.length)
          ? 'Locked in. Building leverage.'
          : 'Monitoring and ready.';
        renderKpis(data.kpis);
        renderTaskList('nowList', data.now);
        renderTaskList('nextList', data.next);
        renderSimpleList('blockedList', data.blocked, 'Blocked: None');
        renderSimpleList('doneList', data.done, 'None');
        renderRisks(data.risks);
        renderActivity(data.activity);

        byId('currentTask').textContent = firstTaskTitle(data.now);
        byId('nextTask').textContent = firstTaskTitle(data.next);
        byId('lastUpdate').textContent = formatTs(data.updatedAt);
        byId('costBadge').textContent = 'Cost: ' + ((data.costMode || 'lean').toUpperCase());
        setStatus(data.updatedAt);
      } catch (e) {
        byId('stateBadge').textContent = 'No data';
        byId('profileStatus').textContent = 'Offline';
        byId('profileStatusSide').textContent = 'Offline';
        byId('profileAnim').textContent = 'No feed';
        byId('profileAvatar').className = 'avatar stale';
        byId('profileAvatarSide').className = 'avatar stale';
        byId('lastUpdate').textContent = 'Could not load memory/todo.json';
      }
    }

    loadBoard();
    setInterval(loadBoard, 60000);
  </script>
</body>
</html>
